<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Dashboard - Chaturvedi Classes</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Chaturvedi Classes" name="keywords">
    <meta content="Chaturvedi Classes" name="description">

    <!-- Favicon -->
    <link href="img/logo.png" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Handlee&family=Nunito&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    <style>
        /* Dashboard Specific Styles */
        .dashboard-container {
            min-height: 100vh;
            background: #f8f9fa;
        }

        .mobile-navbar {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1002;
        }

        .mobile-navbar .navbar-brand {
            display: flex;
            align-items: center;
        }

        .mobile-navbar .navbar-brand img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
        }

        .mobile-navbar .navbar-brand span {
            font-weight: bold;
            color: #dc3545;
        }

        .mobile-navbar .nav-icons {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mobile-navbar .nav-icons a {
            color: #333;
            font-size: 1.2rem;
        }

        .mobile-navbar .google-play-btn {
            width: 120px;
            transition: all 0.3s;
        }

        .mobile-navbar .google-play-btn:hover {
            transform: scale(1.05);
        }

        .sidebar {
            background: linear-gradient(45deg, #990000, #dc3545);
            min-height: 100vh;
            padding: 20px 0;
            position: fixed;
            width: 250px;
            color: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 20px;
            margin-bottom: 30px;
        }

        .sidebar-logo {
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
        }

        .sidebar-title {
            font-size: 1.2rem;
            color: #ffc107;
            text-align: center;
            margin: 0;
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 0 15px 20px;
            text-align: center;
            backdrop-filter: blur(5px);
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-card:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .profile-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 10px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #dc3545;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .profile-img:hover {
            transform: scale(1.05);
        }

        .user-email {
            color: rgba(255, 255, 255, 0.7) !important;
            font-size: 0.9rem;
        }

        .profile-settings {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .profile-settings.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .google-play-badge {
            position: fixed;
            bottom: 20px;
            left: 40%;
            transform: translateX(-50%);
            text-align: center;
        }

        .google-play-badge img {
            width: 140px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .google-play-badge img:hover {
            transform: scale(1.05);
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            margin: 3px 0;
            border-radius: 5px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .content-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .welcome-header {
            background: linear-gradient(45deg, #990000, #dc3545);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .resource-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .resource-card .card-body {
            padding: 20px;
        }

        .resource-card .card-title {
            color: #dc3545;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .resource-card .btn {
            background: linear-gradient(45deg, #990000, #dc3545);
            border: none;
            padding: 8px 20px;
            font-size: 0.9rem;
        }

        .resource-card .btn:hover {
            background: linear-gradient(45deg, #dc3545, #990000);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .mobile-navbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .sidebar {
                transform: translateX(-100%);
                top: 60px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
                margin-top: 60px;
            }

            .google-play-badge {
                display: none;
            }
        }
    </style>
</head>

<body class="dashboard-container">
    <!-- Mobile Navbar -->
    <nav class="mobile-navbar">
        <div class="navbar-brand">
            <img src="img/logo.png" alt="Chaturvedi Classes">
            <span>Chaturvedi Classes</span>
        </div>
        <div class="nav-icons">
            <a href="#" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.chaturvediclasses.app" target="_blank">
                <img src="img/googleplay.png" alt="Get it on Google Play" class="google-play-btn">
            </a>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="img/logo.png" alt="Chaturvedi Classes" class="sidebar-logo">
            <h4 class="sidebar-title">Chaturvedi Classes</h4>
        </div>

        <div class="profile-card" id="profileCard">
            <div class="profile-img">
                <i class="fas fa-user"></i>
            </div>
            <h5 id="userName" class="text-white mb-2">Loading...</h5>
            <p id="userEmail" class="user-email mb-0">Loading...</p>
        </div>

        <nav class="nav flex-column">
            <a class="nav-link active" href="#dashboard">
                <i class="fas fa-home"></i> Dashboard
            </a>
            <a class="nav-link" href="#notes">
                <i class="fas fa-book"></i> Notes
            </a>
            <a class="nav-link" href="#videos">
                <i class="fas fa-video"></i> Video Lectures
            </a>
            <a class="nav-link" href="#papers">
                <i class="fas fa-file-alt"></i> Sample Papers
            </a>
            <a class="nav-link" href="#profile">
                <i class="fas fa-user-cog"></i> Profile Settings
            </a>
            <a class="nav-link" href="#" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>

        <!-- Google Play Badge (Desktop) -->
        <div class="google-play-badge">
            <a href="https://play.google.com/store/apps/details?id=com.chaturvediclasses.app" target="_blank">
                <img src="img/googleplay.png" alt="Get it on Google Play">
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="welcome-header">
            <h2>Welcome, <span id="welcomeName">Student</span>!</h2>
            <p class="mb-0">Access your learning materials and track your progress</p>
        </div>

        <!-- Profile Settings -->
        <div class="profile-settings" id="profileSettings">
            <h5 class="text-danger mb-3">Profile Settings</h5>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control" id="profileName" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="profileEmail" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Mobile Number</label>
                        <input type="tel" class="form-control" id="profileMobile" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Course</label>
                        <input type="text" class="form-control" id="profileCourse" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Age Group</label>
                        <input type="text" class="form-control" id="profileAgeGroup" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent">
            <div class="row">
                <div class="col-md-4">
                    <div class="content-card">
                        <h4 class="text-danger">Your Course</h4>
                        <p id="userCourse">Loading...</p>
                        <p id="userAgeGroup">Loading...</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="content-card">
                        <h4 class="text-danger">Recent Activity</h4>
                        <p>No recent activity</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="content-card">
                        <h4 class="text-danger">Upcoming Tests</h4>
                        <p>No upcoming tests</p>
                    </div>
                </div>
            </div>

            <!-- Resources Section -->
            <h3 class="mt-4 mb-3">Learning Resources</h3>
            <div class="row">
                <div class="col-md-4">
                    <div class="card resource-card">
                        <img class="card-img-top" src="img/blog-1.jpg" alt="Notes">
                        <div class="card-body">
                            <h5 class="card-title">Study Notes</h5>
                            <p class="card-text">Access comprehensive study notes for all subjects</p>
                            <a href="#notes" class="btn btn-primary">View Notes</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card resource-card">
                        <img class="card-img-top" src="img/blog-2.jpg" alt="Video Lectures">
                        <div class="card-body">
                            <h5 class="card-title">Video Lectures</h5>
                            <p class="card-text">Watch recorded lectures from expert teachers</p>
                            <a href="#videos" class="btn btn-primary">Watch Videos</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card resource-card">
                        <img class="card-img-top" src="img/blog-3.jpg" alt="Sample Papers">
                        <div class="card-body">
                            <h5 class="card-title">Sample Papers</h5>
                            <p class="card-text">Practice with previous year question papers</p>
                            <a href="#papers" class="btn btn-primary">View Papers</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyARe1dyFVhMkf5V3DlKI2t3ksl7GFeZXZQ",
            authDomain: "elearning-33716.firebaseapp.com",
            databaseURL: "https://elearning-33716-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "elearning-33716",
            storageBucket: "elearning-33716.firebasestorage.app",
            messagingSenderId: "1032179731946",
            appId: "1:1032179731946:web:e26242f924fbe7cca0b693"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Check if user is logged in
        window.addEventListener('load', function() {
            console.log('Dashboard page loaded');
            
            const userEmail = localStorage.getItem('userEmail');
            const userUID = localStorage.getItem('userUID');
            
            console.log('LocalStorage check:', { userEmail, userUID });

            if (!userEmail || !userUID) {
                console.log('No user data in localStorage, redirecting to auth');
                window.location.href = 'auth.html';
                return;
            }

            // Fetch user data from Firebase
            const userRef = ref(database, 'users/' + userUID);
            console.log('Fetching user data from Firebase:', userRef.toString());

            get(userRef)
                .then((snapshot) => {
                    console.log('Firebase response:', snapshot.val());
                    
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        console.log('User data found:', userData);
                        
                        // Update UI with user data
                        document.getElementById('userName').textContent = userData.name;
                        document.getElementById('userEmail').textContent = userData.email;
                        document.getElementById('welcomeName').textContent = userData.name;
                        document.getElementById('userCourse').textContent = `Course: Class ${userData.course}`;
                        document.getElementById('userAgeGroup').textContent = `Age Group: ${userData.ageGroup} Years`;
                        
                        // Update profile settings
                        document.getElementById('profileName').value = userData.name;
                        document.getElementById('profileEmail').value = userData.email;
                        document.getElementById('profileMobile').value = userData.mobile;
                        document.getElementById('profileCourse').value = `Class ${userData.course}`;
                        document.getElementById('profileAgeGroup').value = `${userData.ageGroup} Years`;
                        
                        // Add a small delay to ensure UI updates
                        setTimeout(() => {
                            console.log('User data updated in UI');
                        }, 1000);
                    } else {
                        console.error('User data not found in Firebase');
                        // Add a delay before redirect
                        setTimeout(() => {
                            localStorage.removeItem('userEmail');
                            localStorage.removeItem('userUID');
                            window.location.href = 'auth.html';
                        }, 2000);
                    }
                })
                .catch((error) => {
                    console.error('Error fetching user data:', error);
                    // Add a delay before redirect
                    setTimeout(() => {
                        localStorage.removeItem('userEmail');
                        localStorage.removeItem('userUID');
                        window.location.href = 'auth.html';
                    }, 2000);
                });
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Logout clicked');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userUID');
            window.location.href = 'auth.html';
        });

        // Navigation handling
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (this.id !== 'logoutBtn') {
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    const section = this.getAttribute('href').substring(1);
                    console.log('Navigating to section:', section);
                }
            });
        });

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const profileCard = document.getElementById('profileCard');
        const profileSettings = document.getElementById('profileSettings');

        mobileMenuBtn.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            // Toggle between menu and close icons
            const icon = this.querySelector('i');
            if (sidebar.classList.contains('active')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Profile card click handler
        profileCard.addEventListener('click', function() {
            profileSettings.classList.toggle('active');
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        });
    </script>
</body>

</html> 